<!-- Modal Lan√ßamento em Massa -->
    <div id="modalLancamentoMassa" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalLancamentoMassa')">&times;</button>
            <div class="modal-header">
                <h2 id="modalTitle">Lan√ßamento em Massa</h2>
                <p>Adicione o mesmo valor em v√°rios meses selecionados</p>
            </div>
            <div class="form-group">
                <label>Tipo:</label>
                <select id="tipoMassa" class="form-control"></select>
            </div>
            <div class="form-group">
                <label>Valor:</label>
                <input type="number" id="valorMassa" class="form-control" placeholder="R$ 0,00" step="0.01">
            </div>
            <div class="form-group">
                <label>Selecionar Meses:</label>
                <div id="mesesMassa"></div>
            </div>
            <button class="btn btn-success" onclick="processarLancamentoMassa()">üíæ Confirmar Lan√ßamentos</button>
        </div>
    </div>

    <!-- Modal Compras do Cart√£o -->
    <div id="modalComprasCartao" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalComprasCartao')">&times;</button>
            <div class="modal-header">
                <h2 id="modalComprasTitle">üí≥ Compras - Nome do Cart√£o</h2>
                <p>Hist√≥rico completo de compras deste cart√£o</p>
            </div>
            <div class="form-group">
                <label>Selecionar Fatura:</label>
                <select id="periodoComprasCartao" class="form-control">
                    <!-- Ser√° preenchido dinamicamente -->
                </select>
            </div>
            <div id="comprasCartaoModal">
                <!-- Compras ser√£o listadas aqui -->
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis Globais
        let sistemaConfigurado = false;
        let dadosSistema = {
            configuracao: null,
            tiposReceita: [],
            tiposDespesa: [],
            receitas: {},
            despesas: {},
            cartoes: [],
            comprasCartao: {},
            versao: '1.1'
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            inicializarSistema();
        });

        // Fun√ß√µes de Inicializa√ß√£o
        function inicializarSistema() {
            popularSelects();
            verificarConfiguracao();
            if (sistemaConfigurado) {
                updateDashboard();
                atualizarListaCartoes();
                atualizarSelectCartoes();
                atualizarListaCompras();
            }
            // Inicializar data atual no campo de compra
            if (document.getElementById('dataCompra')) {
                document.getElementById('dataCompra').value = new Date().toISOString().split('T')[0];
            }
            // Adicionar evento do filtro de compras
            adicionarEventoFiltroCompras();
        }

        function popularSelects() {
            const currentYear = new Date().getFullYear();
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];

            // Popular selects de m√™s
            const monthSelects = ['mesInicio', 'currentMonth', 'mesReceita', 'mesDespesa'];
            monthSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '';
                    months.forEach((month, index) => {
                        for (let year = currentYear - 2; year <= currentYear + 2; year++) {
                            const option = document.createElement('option');
                            option.value = `${year}-${String(index + 1).padStart(2, '0')}`;
                            option.textContent = `${month}/${year}`;
                            select.appendChild(option);
                        }
                    });
                }
            });

            // Popular selects de ano
            const yearSelects = ['anoInicio', 'anoRelatorio'];
            yearSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '';
                    for (let year = currentYear - 5; year <= currentYear + 5; year++) {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        if (year === currentYear) option.selected = true;
                        select.appendChild(option);
                    }
                }
            });

            // Setar m√™s atual
            const currentDate = new Date();
            const currentMonthKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            if (document.getElementById('currentMonth')) {
                document.getElementById('currentMonth').value = currentMonthKey;
            }
        }

        // Configura√ß√£o do Sistema
        function verificarConfiguracao() {
            const statusEl = document.getElementById('configStatus');
            if (dadosSistema.configuracao) {
                sistemaConfigurado = true;
                const config = dadosSistema.configuracao;
                statusEl.innerHTML = `
                    <div class="alert alert-success">
                        ‚úÖ Sistema configurado!<br>
                        <strong>In√≠cio:</strong> ${config.mesInicio}/${config.anoInicio}<br>
                        <strong>Saldo Inicial:</strong> ${formatarMoeda(config.saldoInicial)}
                    </div>
                `;
                
                // Preencher campos
                document.getElementById('mesInicio').value = config.mesInicio;
                document.getElementById('anoInicio').value = config.anoInicio;
                document.getElementById('saldoInicial').value = config.saldoInicial;
            } else {
                statusEl.innerHTML = `
                    <div class="alert alert-warning">
                        ‚ö†Ô∏è Configure o sistema antes de come√ßar a usar
                    </div>
                `;
            }
        }

        function configurarSistema() {
            const mesInicio = document.getElementById('mesInicio').value;
            const anoInicio = parseInt(document.getElementById('anoInicio').value);
            const saldoInicial = parseFloat(document.getElementById('saldoInicial').value) || 0;

            dadosSistema.configuracao = {
                mesInicio: parseInt(mesInicio),
                anoInicio,
                saldoInicial,
                dataConfiguracao: new Date().toISOString()
            };

            // Adicionar saldo inicial como receita se maior que zero
            if (saldoInicial > 0) {
                const chaveInicial = `${anoInicio}-${String(mesInicio).padStart(2, '0')}`;
                
                // Criar tipo "Saldo Inicial" se n√£o existir
                if (!dadosSistema.tiposReceita.find(t => t.nome === 'Saldo Inicial')) {
                    dadosSistema.tiposReceita.push({
                        id: generateId(),
                        nome: 'Saldo Inicial',
                        dataCriacao: new Date().toISOString()
                    });
                }

                // Adicionar receita de saldo inicial
                if (!dadosSistema.receitas[chaveInicial]) {
                    dadosSistema.receitas[chaveInicial] = [];
                }

                dadosSistema.receitas[chaveInicial].push({
                    id: generateId(),
                    tipo: 'Saldo Inicial',
                    valor: saldoInicial,
                    data: new Date().toISOString()
                });
            }

            salvarDados();
            sistemaConfigurado = true;
            verificarConfiguracao();
            atualizarSelectsTipos();
            updateDashboard();

            alert('‚úÖ Sistema configurado com sucesso!');
        }

        // FUN√á√ïES PARA CART√ïES
        function cadastrarCartao() {
            if (!sistemaConfigurado) {
                alert('‚ö†Ô∏è Configure o sistema primeiro na aba Configura√ß√£o');
                return;
            }

            const nome = document.getElementById('nomeCartao').value.trim();
            const vencimento = parseInt(document.getElementById('vencimentoCartao').value);
            const melhorDia = parseInt(document.getElementById('melhorDiaCartao').value);

            // Valida√ß√µes
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome para o cart√£o');
                return;
            }

            if (!vencimento || vencimento < 1 || vencimento > 31) {
                alert('‚ö†Ô∏è Digite um dia v√°lido para vencimento (1 a 31)');
                return;
            }

            if (!melhorDia || melhorDia < 1 || melhorDia > 31) {
                alert('‚ö†Ô∏è Digite um dia v√°lido para melhor dia de compra (1 a 31)');
                return;
            }

            // Verificar se j√° existe cart√£o com mesmo nome
            if (dadosSistema.cartoes.find(c => c.nome.toLowerCase() === nome.toLowerCase())) {
                alert('‚ö†Ô∏è J√° existe um cart√£o com este nome');
                return;
            }

            // Criar novo cart√£o
            const novoCartao = {
                id: generateId(),
                nome,
                vencimento,
                melhorDia,
                dataCriacao: new Date().toISOString()
            };

            dadosSistema.cartoes.push(novoCartao);
            
            // Limpar formul√°rio
            document.getElementById('nomeCartao').value = '';
            document.getElementById('vencimentoCartao').value = '';
            document.getElementById('melhorDiaCartao').value = '';

            salvarDados();
            atualizarListaCartoes();
            atualizarSelectCartoes();

            alert(`‚úÖ Cart√£o "${nome}" cadastrado com sucesso!`);
        }

        function excluirCartao(id) {
            const cartao = dadosSistema.cartoes.find(c => c.id === id);
            if (!cartao) return;

            if (confirm(`üóëÔ∏è Tem certeza que deseja excluir o cart√£o "${cartao.nome}"?\n\nTodas as compras deste cart√£o tamb√©m ser√£o removidas!`)) {
                // Remover cart√£o
                dadosSistema.cartoes = dadosSistema.cartoes.filter(c => c.id !== id);
                
                // Remover todas as compras deste cart√£o
                if (dadosSistema.comprasCartao[id]) {
                    delete dadosSistema.comprasCartao[id];
                }

                salvarDados();
                atualizarListaCartoes();
                atualizarSelectCartoes();
                atualizarListaCompras();

                alert(`‚úÖ Cart√£o "${cartao.nome}" exclu√≠do com sucesso!`);
            }
        }

        function registrarCompra() {
            if (!sistemaConfigurado) {
                alert('‚ö†Ô∏è Configure o sistema primeiro na aba Configura√ß√£o');
                return;
            }

            const cartaoId = document.getElementById('cartaoCompra').value;
            const descricao = document.getElementById('descricaoCompra').value.trim();
            const valor = parseFloat(document.getElementById('valorCompra').value);
            const dataCompra = document.getElementById('dataCompra').value;

            // Valida√ß√µes
            if (!cartaoId) {
                alert('‚ö†Ô∏è Selecione um cart√£o');
                return;
            }

            if (!descricao) {
                alert('‚ö†Ô∏è Digite uma descri√ß√£o para a compra');
                return;
            }

            if (!valor || valor <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido');
                return;
            }

            if (!dataCompra) {
                alert('‚ö†Ô∏è Selecione a data da compra');
                return;
            }

            // Buscar dados do cart√£o
            const cartao = dadosSistema.cartoes.find(c => c.id === cartaoId);
            if (!cartao) {
                alert('‚ùå Cart√£o n√£o encontrado');
                return;
            }

            // Calcular qual fatura esta compra pertence
            const mesVencimento = calcularMesVencimento(dataCompra, cartao.melhorDia, cartao.vencimento);

            // Criar nova compra
            const novaCompra = {
                id: generateId(),
                cartaoId,
                cartaoNome: cartao.nome,
                descricao,
                valor,
                dataCompra,
                mesVencimento,
                dataCriacao: new Date().toISOString()
            };

            // Adicionar compra ao sistema
            if (!dadosSistema.comprasCartao[cartaoId]) {
                dadosSistema.comprasCartao[cartaoId] = [];
            }
            dadosSistema.comprasCartao[cartaoId].push(novaCompra);

            // Limpar formul√°rio
            document.getElementById('descricaoCompra').value = '';
            document.getElementById('valorCompra').value = '';
            document.getElementById('dataCompra').value = new Date().toISOString().split('T')[0];

            salvarDados();
            atualizarListaCartoes();
            atualizarListaCompras();

            alert(`‚úÖ Compra de ${formatarMoeda(valor)} registrada no cart√£o ${cartao.nome}!`);
        }

        function calcularMesVencimento(dataCompra, melhorDia, vencimento) {
            const data = new Date(dataCompra);
            const diaCompra = data.getDate();
            const mesCompra = data.getMonth();
            const anoCompra = data.getFullYear();

            let mesVencimento, anoVencimento;

            if (diaCompra >= melhorDia) {
                // Compra ap√≥s melhor dia: vai para pr√≥xima fatura
                if (mesCompra === 11) { // Dezembro
                    mesVencimento = 0; // Janeiro
                    anoVencimento = anoCompra + 1;
                } else {
                    mesVencimento = mesCompra + 1;
                    anoVencimento = anoCompra;
                }
            } else {
                // Compra antes do melhor dia: vai para fatura atual
                mesVencimento = mesCompra;
                anoVencimento = anoCompra;
            }

            return `${anoVencimento}-${String(mesVencimento + 1).padStart(2, '0')}`;
        }

        function calcularFaturaCartao(cartaoId) {
            const compras = dadosSistema.comprasCartao[cartaoId] || [];
            const mesAtual = new Date().toISOString().slice(0, 7);
            
            return compras
                .filter(compra => compra.mesVencimento === mesAtual)
                .reduce((total, compra) => total + compra.valor, 0);
        }

        function atualizarListaCartoes() {
            const container = document.getElementById('listaCartoes');
            if (!container) return;

            if (dadosSistema.cartoes.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>üìã Nenhum cart√£o cadastrado ainda</strong><br>
                        Use o formul√°rio acima para cadastrar seu primeiro cart√£o de cr√©dito.
                    </div>
                `;
                return;
            }

            let html = '';
            dadosSistema.cartoes.forEach(cartao => {
                const faturaAtual = calcularFaturaCartao(cartao.id);
                
                html += `
                    <div class="cartao-item">
                        <div class="cartao-header">
                            <div class="cartao-nome">üí≥ ${cartao.nome}</div>
                            <div>
                                <button class="btn btn-info" onclick="verComprasCartao('${cartao.id}')" style="padding: 8px 15px; margin-right: 10px;">üìä Ver Compras</button>
                                <button class="btn btn-danger" onclick="excluirCartao('${cartao.id}')" style="padding: 8px 15px;">üóëÔ∏è Excluir</button>
                            </div>
                        </div>
                        <div class="cartao-info">
                            <div>
                                <div class="label">Vencimento</div>
                                <div class="value">Dia ${cartao.vencimento}</div>
                            </div>
                            <div>
                                <div class="label">Melhor Dia</div>
                                <div class="value">Dia ${cartao.melhorDia}</div>
                            </div>
                            <div>
                                <div class="label">Fatura Atual</div>
                                <div class="value">${formatarMoeda(faturaAtual)}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function atualizarSelectCartoes() {
            // Atualizar select para registro de compras
            const selectCartaoCompra = document.getElementById('cartaoCompra');
            if (selectCartaoCompra) {
                selectCartaoCompra.innerHTML = '<option value="">Selecione um cart√£o...</option>';
                dadosSistema.cartoes.forEach(cartao => {
                    const option = document.createElement('option');
                    option.value = cartao.id;
                    option.textContent = cartao.nome;
                    selectCartaoCompra.appendChild(option);
                });
            }

            // Atualizar select de filtro de compras
            const selectFiltro = document.getElementById('filtroCartaoCompras');
            if (selectFiltro) {
                selectFiltro.innerHTML = '<option value="">Todos os cart√µes</option>';
                dadosSistema.cartoes.forEach(cartao => {
                    const option = document.createElement('option');
                    option.value = cartao.id;
                    option.textContent = cartao.nome;
                    selectFiltro.appendChild(option);
                });
            }
        }

        function atualizarListaCompras() {
            const container = document.getElementById('listaCompras');
            if (!container) return;

            // Buscar todas as compras do m√™s atual
            const mesAtual = new Date().toISOString().slice(0, 7);
            const todasCompras = [];

            Object.keys(dadosSistema.comprasCartao).forEach(cartaoId => {
                const comprasCartao = dadosSistema.comprasCartao[cartaoId] || [];
                comprasCartao.forEach(compra => {
                    if (compra.dataCompra.startsWith(mesAtual)) {
                        todasCompras.push(compra);
                    }
                });
            });

            // Filtrar por cart√£o se selecionado
            const filtroCartao = document.getElementById('filtroCartaoCompras')?.value;
            const comprasFiltradas = filtroCartao ? 
                todasCompras.filter(c => c.cartaoId === filtroCartao) : 
                todasCompras;

            if (comprasFiltradas.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <strong>üìã Nenhuma compra registrada ainda</strong><br>
                        Use o formul√°rio acima para registrar suas compras no cart√£o de cr√©dito.
                    </div>
                `;
                return;
            }

            // Ordenar por data (mais recente primeiro)
            comprasFiltradas.sort((a, b) => new Date(b.dataCompra) - new Date(a.dataCompra));

            let html = '';
            comprasFiltradas.forEach(compra => {
                const dataFormatada = new Date(compra.dataCompra).toLocaleDateString('pt-BR');
                html += `
                    <div class="compra-item">
                        <div class="compra-info">
                            <div class="compra-data">üìÖ ${dataFormatada} - ${compra.cartaoNome}</div>
                            <div class="compra-descricao">üõí ${compra.descricao}</div>
                        </div>
                        <div class="compra-valor">${formatarMoeda(compra.valor)}</div>
                        <button class="btn btn-danger" onclick="excluirCompra('${compra.cartaoId}', '${compra.id}')" style="padding: 8px 12px; margin-left: 15px;">üóëÔ∏è</button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function excluirCompra(cartaoId, compraId) {
            if (confirm('üóëÔ∏è Tem certeza que deseja excluir esta compra?')) {
                if (dadosSistema.comprasCartao[cartaoId]) {
                    dadosSistema.comprasCartao[cartaoId] = dadosSistema.comprasCartao[cartaoId]
                        .filter(c => c.id !== compraId);
                    
                    // Se n√£o h√° mais compras, remover array vazio
                    if (dadosSistema.comprasCartao[cartaoId].length === 0) {
                        delete dadosSistema.comprasCartao[cartaoId];
                    }
                }

                salvarDados();
                atualizarListaCartoes();
                atualizarListaCompras();

                alert('‚úÖ Compra exclu√≠da com sucesso!');
            }
        }

        function adicionarEventoFiltroCompras() {
            const filtro = document.getElementById('filtroCartaoCompras');
            if (filtro) {
                filtro.addEventListener('change', atualizarListaCompras);
            }
        }

        function verComprasCartao(cartaoId) {
            const cartao = dadosSistema.cartoes.find(c => c.id === cartaoId);
            if (!cartao) {
                alert('‚ùå Cart√£o n√£o encontrado');
                return;
            }

            // Configurar modal
            document.getElementById('modalComprasTitle').textContent = `üí≥ Compras - ${cartao.nome}`;
            
            // Configurar seletor de faturas
            configurarSeletorFaturas(cartaoId);
            
            // Mostrar modal
            const modal = document.getElementById('modalComprasCartao');
            modal.cartaoAtual = cartaoId;
            modal.classList.add('show');

            // Carregar compras da fatura atual
            atualizarComprasModal(cartaoId);

            // Adicionar evento ao filtro de fatura
            const seletorFatura = document.getElementById('periodoComprasCartao');
            seletorFatura.removeEventListener('change', handleFaturaChange);
            seletorFatura.addEventListener('change', handleFaturaChange);
        }

        function configurarSeletorFaturas(cartaoId) {
            const seletor = document.getElementById('periodoComprasCartao');
            const comprasCartao = dadosSistema.comprasCartao[cartaoId] || [];
            
            // Obter todos os meses de vencimento √∫nicos das compras
            const mesesVencimento = new Set();
            comprasCartao.forEach(compra => {
                mesesVencimento.add(compra.mesVencimento);
            });

            // Adicionar m√™s atual e pr√≥ximos 6 meses (para futuras compras)
            const hoje = new Date();
            for (let i = 0; i <= 6; i++) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() + i, 1);
                const mesAno = `${data.getFullYear()}-${String(data.getMonth() + 1).padStart(2, '0')}`;
                mesesVencimento.add(mesAno);
            }

            // Adicionar 6 meses anteriores (para hist√≥rico)
            for (let i = 1; i <= 6; i++) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                const mesAno = `${data.getFullYear()}-${String(data.getMonth() + 1).padStart(2, '0')}`;
                mesesVencimento.add(mesAno);
            }

            // Converter para array e ordenar (mais recente primeiro)
            const mesesOrdenados = Array.from(mesesVencimento).sort().reverse();

            // Gerar op√ß√µes do select
            const mesAtual = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
            let html = '';
            
            mesesOrdenados.forEach(mesAno => {
                const [ano, mes] = mesAno.split('-');
                const nomeMes = [
                    'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                ][parseInt(mes) - 1];

                const totalFatura = calcularTotalFatura(cartaoId, mesAno);
                const qtdCompras = contarComprasFatura(cartaoId, mesAno);
                
                let status = '';
                if (mesAno === mesAtual) {
                    status = ' (Atual)';
                } else if (mesAno > mesAtual) {
                    status = ' (Futura)';
                }

                const texto = qtdCompras > 0 ? 
                    `${nomeMes}/${ano}${status} - ${formatarMoeda(totalFatura)} (${qtdCompras} compras)` :
                    `${nomeMes}/${ano}${status}`;

                const selected = mesAno === mesAtual ? 'selected' : '';
                html += `<option value="${mesAno}" ${selected}>${texto}</option>`;
            });

            seletor.innerHTML = html;
        }

        function calcularTotalFatura(cartaoId, mesVencimento) {
            const comprasCartao = dadosSistema.comprasCartao[cartaoId] || [];
            return comprasCartao
                .filter(compra => compra.mesVencimento === mesVencimento)
                .reduce((total, compra) => total + compra.valor, 0);
        }

        function contarComprasFatura(cartaoId, mesVencimento) {
            const comprasCartao = dadosSistema.comprasCartao[cartaoId] || [];
            return comprasCartao.filter(compra => compra.mesVencimento === mesVencimento).length;
        }

        function handleFaturaChange() {
            const modal = document.getElementById('modalComprasCartao');
            const cartaoId = modal.cartaoAtual;
            if (cartaoId) {
                atualizarComprasModal(cartaoId);
            }
        }

        function atualizarComprasModal(cartaoId) {
            const container = document.getElementById('comprasCartaoModal');
            const mesVencimentoSelecionado = document.getElementById('periodoComprasCartao').value;
            const comprasCartao = dadosSistema.comprasCartao[cartaoId] || [];

            // Filtrar compras pela fatura selecionada
            const comprasDaFatura = comprasCartao.filter(compra => 
                compra.mesVencimento === mesVencimentoSelecionado
            );

            if (comprasDaFatura.length === 0) {
                const [ano, mes] = mesVencimentoSelecionado.split('-');
                const nomeMes = [
                    'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                ][parseInt(mes) - 1];

                container.innerHTML = `
                    <div class="alert alert-info">
                        <strong>üìã Nenhuma compra na fatura de ${nomeMes}/${ano}</strong><br>
                        Esta fatura est√° vazia. Registre compras para visualiz√°-las aqui.
                    </div>
                `;
                return;
            }

            // Calcular estat√≠sticas da fatura
            const totalFatura = comprasDaFatura.reduce((sum, c) => sum + c.valor, 0);
            const mediaCompra = totalFatura / comprasDaFatura.length;

            // Obter informa√ß√µes da fatura
            const [anoFatura, mesFatura] = mesVencimentoSelecionado.split('-');
            const nomeMesFatura = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ][parseInt(mesFatura) - 1];

            // Determinar status da fatura
            const hoje = new Date();
            const mesAtual = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
            let statusFatura = '';
            let corStatus = '#17a2b8';

            if (mesVencimentoSelecionado === mesAtual) {
                statusFatura = 'üü¢ Fatura Atual';
                corStatus = '#28a745';
            } else if (mesVencimentoSelecionado > mesAtual) {
                statusFatura = 'üîµ Fatura Futura';
                corStatus = '#007bff';
            } else {
                statusFatura = '‚ö´ Fatura Passada';
                corStatus = '#6c757d';
            }

            // Ordenar compras por data (mais recente primeiro)
            comprasDaFatura.sort((a, b) => new Date(b.dataCompra) - new Date(a.dataCompra));

            // Gerar HTML
            let html = `
                <!-- Cabe√ßalho da Fatura -->
                <div class="card" style="margin-bottom: 20px; border-left: 4px solid ${corStatus};">
                    <div class="card-body" style="padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h5 style="margin: 0; color: #2c3e50;">üìÑ Fatura ${nomeMesFatura}/${anoFatura}</h5>
                            <span style="background: ${corStatus}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: 600;">
                                ${statusFatura}
                            </span>
                        </div>
                        
                        <div class="grid-3">
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: #6c757d;">Total da Fatura</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: ${corStatus};">${formatarMoeda(totalFatura)}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: #6c757d;">M√©dia por Compra</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: ${corStatus};">${formatarMoeda(mediaCompra)}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: #6c757d;">Quantidade</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: ${corStatus};">${comprasDaFatura.length}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Compras da Fatura -->
                <div style="max-height: 400px; overflow-y: auto;">
                    <h6 style="color: #2c3e50; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        üõí Compras desta Fatura
                    </h6>
            `;

            comprasDaFatura.forEach(compra => {
                const dataFormatada = new Date(compra.dataCompra).toLocaleDateString('pt-BR');
                
                // Calcular h√° quantos dias foi feita a compra
                const diasAtras = Math.floor((hoje - new Date(compra.dataCompra)) / (1000 * 60 * 60 * 24));
                let tempoTexto = '';
                if (diasAtras === 0) {
                    tempoTexto = 'Hoje';
                } else if (diasAtras === 1) {
                    tempoTexto = 'Ontem';
                } else if (diasAtras > 0) {
                    tempoTexto = `${diasAtras} dias atr√°s`;
                } else {
                    tempoTexto = 'Futuro';
                }

                html += `
                    <div class="compra-item" style="margin-bottom: 12px; border-left: 3px solid ${corStatus};">
                        <div class="compra-info">
                            <div class="compra-descricao" style="margin-bottom: 8px; font-size: 1.1rem;">üõí ${compra.descricao}</div>
                            <div class="compra-data" style="font-size: 0.9rem;">
                                üìÖ ${dataFormatada} ‚Ä¢ ‚è±Ô∏è ${tempoTexto}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="compra-valor" style="font-size: 1.2rem;">${formatarMoeda(compra.valor)}</div>
                            <button class="btn btn-danger" onclick="excluirCompraModal('${compra.cartaoId}', '${compra.id}')" 
                                    style="padding: 8px 12px; font-size: 0.8rem;" title="Excluir compra">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            container.innerHTML = html;
        }

        function excluirCompraModal(cartaoId, compraId) {
            if (confirm('üóëÔ∏è Tem certeza que deseja excluir esta compra?\n\nEsta a√ß√£o ir√° remover a compra da fatura.')) {
                // Usar a fun√ß√£o j√° existente
                excluirCompra(cartaoId, compraId);
                
                // Reconfigurar seletor (pode ter mudado o total)
                configurarSeletorFaturas(cartaoId);
                
                // Atualizar modal
                atualizarComprasModal(cartaoId);
            }
        }

        // Fun√ß√µes de Tipos (mantidas do sistema original)
        function criarTipoReceita() {
            const nome = document.getElementById('novoTipoReceita').value.trim();
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome para o tipo de receita');
                return;
            }

            if (dadosSistema.tiposReceita.find(t => t.nome.toLowerCase() === nome.toLowerCase())) {
                alert('‚ö†Ô∏è Este tipo j√° existe');
                return;
            }

            dadosSistema.tiposReceita.push({
                id: generateId(),
                nome,
                dataCriacao: new Date().toISOString()
            });

            document.getElementById('novoTipoReceita').value = '';
            salvarDados();
            atualizarSelectsTipos();
            listarTiposReceita();
            alert('‚úÖ Tipo de receita criado com sucesso!');
        }

        function criarTipoDespesa() {
            const nome = document.getElementById('novoTipoDespesa').value.trim();
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome para o tipo de despesa');
                return;
            }

            if (dadosSistema.tiposDespesa.find(t => t.nome.toLowerCase() === nome.toLowerCase())) {
                alert('‚ö†Ô∏è Este tipo j√° existe');
                return;
            }

            dadosSistema.tiposDespesa.push({
                id: generateId(),
                nome,
                dataCriacao: new Date().toISOString()
            });

            document.getElementById('novoTipoDespesa').value = '';
            salvarDados();
            atualizarSelectsTipos();
            listarTiposDespesa();
            alert('‚úÖ Tipo de despesa criado com sucesso!');
        }

        function excluirTipoReceita(id) {
            if (confirm('üóëÔ∏è Tem certeza que deseja excluir este tipo? Todos os lan√ßamentos deste tipo ser√£o removidos!')) {
                const tipo = dadosSistema.tiposReceita.find(t => t.id === id);
                if (tipo) {
                    // Remover todas as receitas deste tipo
                    Object.keys(dadosSistema.receitas).forEach(chave => {
                        dadosSistema.receitas[chave] = dadosSistema.receitas[chave].filter(r => r.tipo !== tipo.nome);
                        if (dadosSistema.receitas[chave].length === 0) {
                            delete dadosSistema.receitas[chave];
                        }
                    });

                    // Remover o tipo
                    dadosSistema.tiposReceita = dadosSistema.tiposReceita.filter(t => t.id !== id);
                    
                    salvarDados();
                    atualizarSelectsTipos();
                    listarTiposReceita();
                    updateDashboard();
                    alert('‚úÖ Tipo exclu√≠do com sucesso!');
                }
            }
        }

        function excluirTipoDespesa(id) {
            if (confirm('üóëÔ∏è Tem certeza que deseja excluir este tipo? Todos os lan√ßamentos deste tipo ser√£o removidos!')) {
                const tipo = dadosSistema.tiposDespesa.find(t => t.id === id);
                if (tipo) {
                    // Remover todas as despesas deste tipo
                    Object.keys(dadosSistema.despesas).forEach(chave => {
                        dadosSistema.despesas[chave] = dadosSistema.despesas[chave].filter(d => d.tipo !== tipo.nome);
                        if (dadosSistema.despesas[chave].length === 0) {
                            delete dadosSistema.despesas[chave];
                        }
                    });

                    // Remover o tipo
                    dadosSistema.tiposDespesa = dadosSistema.tiposDespesa.filter(t => t.id !== id);
                    
                    salvarDados();
                    atualizarSelectsTipos();
                    listarTiposDespesa();
                    updateDashboard();
                    alert('‚úÖ Tipo exclu√≠do com sucesso!');
                }
            }
        }

        function atualizarSelectsTipos() {
            // Atualizar select de receitas
            const selectReceita = document.getElementById('tipoReceita');
            if (selectReceita) {
                selectReceita.innerHTML = '<option value="">Selecione um tipo...</option>';
                dadosSistema.tiposReceita.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo.nome;
                    option.textContent = tipo.nome;
                    selectReceita.appendChild(option);
                });
            }

            // Atualizar select de despesas
            const selectDespesa = document.getElementById('tipoDespesa');
            if (selectDespesa) {
                selectDespesa.innerHTML = '<option value="">Selecione um tipo...</option>';
                dadosSistema.tiposDespesa.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo.nome;
                    option.textContent = tipo.nome;
                    selectDespesa.appendChild(option);
                });
            }
        }

        function listarTiposReceita() {
            const container = document.getElementById('tiposReceitaList');
            if (!container) return;

            if (dadosSistema.tiposReceita.length === 0) {
                container.innerHTML = '<p class="alert alert-info">Nenhum tipo de receita cadastrado</p>';
                return;
            }

            let html = '<h5 style="margin-top: 20px;">Tipos Cadastrados:</h5>';
            dadosSistema.tiposReceita.forEach(tipo => {
                html += `
                    <div class="tipo-item">
                        <span><strong>${tipo.nome}</strong></span>
                        <button class="btn btn-danger" onclick="excluirTipoReceita('${tipo.id}')" style="padding: 5px 10px;">üóëÔ∏è Excluir</button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function listarTiposDespesa() {
            const container = document.getElementById('tiposDespesaList');
            if (!container) return;

            if (dadosSistema.tiposDespesa.length === 0) {
                container.innerHTML = '<p class="alert alert-info">Nenhum tipo de despesa cadastrado</p>';
                return;
            }

            let html = '<h5 style="margin-top: 20px;">Tipos Cadastrados:</h5>';
            dadosSistema.tiposDespesa.forEach(tipo => {
                html += `
                    <div class="tipo-item">
                        <span><strong>${tipo.nome}</strong></span>
                        <button class="btn btn-danger" onclick="excluirTipoDespesa('${tipo.id}')" style="padding: 5px 10px;">üóëÔ∏è Excluir</button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Fun√ß√µes de Lan√ßamentos (mantidas do sistema original)
        function adicionarReceita() {
            if (!sistemaConfigurado) {
                alert('‚ö†Ô∏è Configure o sistema primeiro na aba Configura√ß√£o');
                return;
            }

            const tipo = document.getElementById('tipoReceita').value;
            const valor = parseFloat(document.getElementById('valorReceita').value);
            const mesAno = document.getElementById('mesReceita').value;

            if (!tipo) {
                alert('‚ö†Ô∏è Selecione um tipo de receita');
                return;
            }

            if (!valor || valor <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido');
                return;
            }

            if (!dadosSistema.receitas[mesAno]) {
                dadosSistema.receitas[mesAno] = [];
            }

            dadosSistema.receitas[mesAno].push({
                id: generateId(),
                tipo,
                valor,
                data: new Date().toISOString()
            });

            document.getElementById('valorReceita').value = '';
            salvarDados();
            updateDashboard();
            alert('‚úÖ Receita adicionada com sucesso!');
        }

        function adicionarDespesa() {
            if (!sistemaConfigurado) {
                alert('‚ö†Ô∏è Configure o sistema primeiro na aba Configura√ß√£o');
                return;
            }

            const tipo = document.getElementById('tipoDespesa').value;
            const valor = parseFloat(document.getElementById('valorDespesa').value);
            const mesAno = document.getElementById('mesDespesa').value;

            if (!tipo) {
                alert('‚ö†Ô∏è Selecione um tipo de despesa');
                return;
            }

            if (!valor || valor <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido');
                return;
            }

            if (!dadosSistema.despesas[mesAno]) {
                dadosSistema.despesas[mesAno] = [];
            }

            dadosSistema.despesas[mesAno].push({
                id: generateId(),
                tipo,
                valor,
                data: new Date().toISOString()
            });

            document.getElementById('valorDespesa').value = '';
            salvarDados();
            updateDashboard();
            alert('‚úÖ Despesa adicionada com sucesso!');
        }

        function excluirLancamento(tipo, mesAno, id) {
            if (confirm('üóëÔ∏è Tem certeza que deseja excluir este lan√ßamento?')) {
                if (tipo === 'receita') {
                    dadosSistema.receitas[mesAno] = dadosSistema.receitas[mesAno].filter(r => r.id !== id);
                    if (dadosSistema.receitas[mesAno].length === 0) {
                        delete dadosSistema.receitas[mesAno];
                    }
                } else {
                    dadosSistema.despesas[mesAno] = dadosSistema.despesas[mesAno].filter(d => d.id !== id);
                    if (dadosSistema.despesas[mesAno].length === 0) {
                        delete dadosSistema.despesas[mesAno];
                    }
                }
                
                salvarDados();
                updateDashboard();
                alert('‚úÖ Lan√ßamento exclu√≠do com sucesso!');
            }
        }

        // Fun√ß√µes de Dashboard (mantidas do sistema original)
        function updateDashboard() {
            if (!sistemaConfigurado) {
                document.getElementById('totalReceitas').textContent = 'Sistema n√£o configurado';
                return;
            }

            const mesAnoSelecionado = document.getElementById('currentMonth').value;
            atualizarResumoMensal(mesAnoSelecionado);
            listarLancamentosMes(mesAnoSelecionado);
        }

        function atualizarResumoMensal(mesAno) {
            const receitas = dadosSistema.receitas[mesAno] || [];
            const despesas = dadosSistema.despesas[mesAno] || [];

            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const saldoMes = totalReceitas - totalDespesas;

            // Calcular saldo acumulado
            const saldoAcumulado = calcularSaldoAcumulado(mesAno);

            document.getElementById('totalReceitas').textContent = formatarMoeda(totalReceitas);
            document.getElementById('totalDespesas').textContent = formatarMoeda(totalDespesas);
            document.getElementById('saldoMes').textContent = formatarMoeda(saldoMes);
            document.getElementById('saldoAcumulado').textContent = formatarMoeda(saldoAcumulado);

            document.getElementById('receitasCount').textContent = `${receitas.length} lan√ßamento${receitas.length !== 1 ? 's' : ''}`;
            document.getElementById('despesasCount').textContent = `${despesas.length} lan√ßamento${despesas.length !== 1 ? 's' : ''}`;
        }

        function calcularSaldoAcumulado(mesAnoAtual) {
            if (!dadosSistema.configuracao) return 0;

            let saldoAcumulado = 0;
            const anoAtual = parseInt(mesAnoAtual.split('-')[0]);
            const mesAtual = parseInt(mesAnoAtual.split('-')[1]);
            
            // Come√ßar do m√™s de configura√ß√£o
            const anoInicio = dadosSistema.configuracao.anoInicio;
            const mesInicio = dadosSistema.configuracao.mesInicio;

            for (let ano = anoInicio; ano <= anoAtual; ano++) {
                const mesInicioAno = (ano === anoInicio) ? mesInicio : 1;
                const mesFinalAno = (ano === anoAtual) ? mesAtual : 12;

                for (let mes = mesInicioAno; mes <= mesFinalAno; mes++) {
                    const chave = `${ano}-${String(mes).padStart(2, '0')}`;
                    const receitas = dadosSistema.receitas[chave] || [];
                    const despesas = dadosSistema.despesas[chave] || [];
                    
                    const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
                    const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
                    
                    saldoAcumulado += (totalReceitas - totalDespesas);
                }
            }

            return saldoAcumulado;
        }

        function listarLancamentosMes(mesAno) {
            const receitas = dadosSistema.receitas[mesAno] || [];
            const despesas = dadosSistema.despesas[mesAno] || [];

            // Listar receitas
            const receitasList = document.getElementById('receitasList');
            if (receitas.length === 0) {
                receitasList.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #6c757d;">Nenhuma receita lan√ßada neste m√™s</td></tr>';
            } else {
                let html = '';
                receitas.forEach(receita => {
                    html += `
                        <tr>
                            <td><strong>${receita.tipo}</strong></td>
                            <td class="valor-receita">${formatarMoeda(receita.valor)}</td>
                            <td>
                                <button class="btn btn-danger" onclick="excluirLancamento('receita', '${mesAno}', '${receita.id}')" style="padding: 5px 10px; font-size: 0.8rem;">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });
                receitasList.innerHTML = html;
            }

            // Listar despesas
            const despesasList = document.getElementById('despesasList');
            if (despesas.length === 0) {
                despesasList.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #6c757d;">Nenhuma despesa lan√ßada neste m√™s</td></tr>';
            } else {
                let html = '';
                despesas.forEach(despesa => {
                    html += `
                        <tr>
                            <td><strong>${despesa.tipo}</strong></td>
                            <td class="valor-despesa">${formatarMoeda(despesa.valor)}</td>
                            <td>
                                <button class="btn btn-danger" onclick="excluirLancamento('despesa', '${mesAno}', '${despesa.id}')" style="padding: 5px 10px; font-size: 0.8rem;">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });
                despesasList.innerHTML = html;
            }
        }

        // Navega√ß√£o de Meses (mantida do sistema original)
        function goToPreviousMonth() {
            const select = document.getElementById('currentMonth');
            const currentIndex = select.selectedIndex;
            if (currentIndex > 0) {
                select.selectedIndex = currentIndex - 1;
                updateDashboard();
            }
        }

        function goToNextMonth() {
            const select = document.getElementById('currentMonth');
            const currentIndex = select.selectedIndex;
            if (currentIndex < select.options.length - 1) {
                select.selectedIndex = currentIndex + 1;
                updateDashboard();
            }
        }

        function goToCurrentMonth() {
            const currentDate = new Date();
            const currentMonthKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            document.getElementById('currentMonth').value = currentMonthKey;
            updateDashboard();
        }

        // Lan√ßamento em Massa (mantido do sistema original)
        function showModal(modalId, tipo) {
            if (!sistemaConfigurado) {
                alert('‚ö†Ô∏è Configure o sistema primeiro na aba Configura√ß√£o');
                return;
            }

            const modal = document.getElementById(modalId);
            const tipoSelect = document.getElementById('tipoMassa');
            const mesesContainer = document.getElementById('mesesMassa');

            // Configurar modal
            if (tipo === 'receita') {
                document.getElementById('modalTitle').textContent = 'Lan√ßamento de Receitas em Massa';
                tipoSelect.innerHTML = '<option value="">Selecione um tipo...</option>';
                dadosSistema.tiposReceita.forEach(t => {
                    tipoSelect.innerHTML += `<option value="${t.nome}">${t.nome}</option>`;
                });
            } else {
                document.getElementById('modalTitle').textContent = 'Lan√ßamento de Despesas em Massa';
                tipoSelect.innerHTML = '<option value="">Selecione um tipo...</option>';
                dadosSistema.tiposDespesa.forEach(t => {
                    tipoSelect.innerHTML += `<option value="${t.nome}">${t.nome}</option>`;
                });
            }

            // Gerar checkboxes de meses
            const currentYear = new Date().getFullYear();
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];

            let html = '';
            for (let year = currentYear - 1; year <= currentYear + 2; year++) {
                html += `<h6 style="margin-top: 15px; margin-bottom: 10px; color: #2c3e50;">${year}</h6>`;
                months.forEach((month, index) => {
                    const value = `${year}-${String(index + 1).padStart(2, '0')}`;
                    html += `
                        <label style="display: block; margin-bottom: 8px; cursor: pointer;">
                            <input type="checkbox" value="${value}" style="margin-right: 8px;">
                            ${month}/${year}
                        </label>
                    `;
                });
            }
            mesesContainer.innerHTML = html;

            modal.tipoLancamento = tipo;
            modal.classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function processarLancamentoMassa() {
            const tipo = document.getElementById('tipoMassa').value;
            const valor = parseFloat(document.getElementById('valorMassa').value);
            const modal = document.getElementById('modalLancamentoMassa');
            const tipoLancamento = modal.tipoLancamento;

            if (!tipo) {
                alert('‚ö†Ô∏è Selecione um tipo');
                return;
            }

            if (!valor || valor <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido');
                return;
            }

            const checkboxes = document.querySelectorAll('#mesesMassa input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('‚ö†Ô∏è Selecione pelo menos um m√™s');
                return;
            }

            let contador = 0;
            checkboxes.forEach(checkbox => {
                const mesAno = checkbox.value;
                
                if (tipoLancamento === 'receita') {
                    if (!dadosSistema.receitas[mesAno]) {
                        dadosSistema.receitas[mesAno] = [];
                    }
                    dadosSistema.receitas[mesAno].push({
                        id: generateId(),
                        tipo,
                        valor,
                        data: new Date().toISOString()
                    });
                } else {
                    if (!dadosSistema.despesas[mesAno]) {
                        dadosSistema.despesas[mesAno] = [];
                    }
                    dadosSistema.despesas[mesAno].push({
                        id: generateId(),
                        tipo,
                        valor,
                        data: new Date().toISOString()
                    });
                }
                contador++;
            });

            salvarDados();
            updateDashboard();
            closeModal('modalLancamentoMassa');
            
            document.getElementById('valorMassa').value = '';
            
            alert(`‚úÖ ${contador} lan√ßamentos adicionados com sucesso!`);
        }

        // Relat√≥rios (mantido do sistema original)
        function gerarRelatorioAnual() {
            if (!sistemaConfigurado) {
                document.getElementById('relatorioAnual').innerHTML = '<p class="alert alert-warning">Configure o sistema primeiro</p>';
                return;
            }

            const ano = parseInt(document.getElementById('anoRelatorio').value);
            const container = document.getElementById('relatorioAnual');

            let html = `
                <div class="card" style="margin-top: 20px;">
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>M√™s</th>
                                    <th style="color: #28a745;">Receitas</th>
                                    <th style="color: #dc3545;">Despesas</th>
                                    <th style="color: #667eea;">Saldo do M√™s</th>
                                    <th style="color: #667eea;">Saldo Acumulado</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];

            let totalReceitasAno = 0;
            let totalDespesasAno = 0;

            for (let mes = 1; mes <= 12; mes++) {
                const chave = `${ano}-${String(mes).padStart(2, '0')}`;
                const receitas = dadosSistema.receitas[chave] || [];
                const despesas = dadosSistema.despesas[chave] || [];

                const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
                const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
                const saldoMes = totalReceitas - totalDespesas;

                // Calcular saldo acumulado real (considerando hist√≥rico)
                const saldoAcumuladoReal = calcularSaldoAcumulado(chave);
                
                totalReceitasAno += totalReceitas;
                totalDespesasAno += totalDespesas;

                html += `
                    <tr>
                        <td><strong>${months[mes - 1]}</strong></td>
                        <td class="valor-receita">${formatarMoeda(totalReceitas)}</td>
                        <td class="valor-despesa">${formatarMoeda(totalDespesas)}</td>
                        <td style="color: ${saldoMes >= 0 ? '#28a745' : '#dc3545'}; font-weight: 600;">${formatarMoeda(saldoMes)}</td>
                        <td style="color: ${saldoAcumuladoReal >= 0 ? '#28a745' : '#dc3545'}; font-weight: 600;">${formatarMoeda(saldoAcumuladoReal)}</td>
                    </tr>
                `;
            }

            const saldoTotalAno = totalReceitasAno - totalDespesasAno;

            html += `
                    </tbody>
                    <tfoot>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td><strong>TOTAL ${ano}</strong></td>
                            <td class="valor-receita">${formatarMoeda(totalReceitasAno)}</td>
                            <td class="valor-despesa">${formatarMoeda(totalDespesasAno)}</td>
                            <td style="color: ${saldoTotalAno >= 0 ? '#28a745' : '#dc3545'};">${formatarMoeda(saldoTotalAno)}</td>
                            <td>-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
            `;

            container.innerHTML = html;
        }

        // Fun√ß√µes de Navega√ß√£o
        function showTab(tabName) {
            // Esconder todas as abas
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Remover classe ativa dos bot√µes
            const buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(button => button.classList.remove('active'));

            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Carregar dados espec√≠ficos da aba
            if (tabName === 'configuracao') {
                verificarConfiguracao();
            } else if (tabName === 'receitas') {
                atualizarSelectsTipos();
                listarTiposReceita();
            } else if (tabName === 'despesas') {
                atualizarSelectsTipos();
                listarTiposDespesa();
            } else if (tabName === 'relatorios') {
                gerarRelatorioAnual();
            } else if (tabName === 'cartoes') {
                atualizarListaCartoes();
                atualizarSelectCartoes();
                atualizarListaCompras();
                adicionarEventoFiltroCompras();
            }
        }

        // Fun√ß√µes de Backup (mantidas do sistema original)
        function exportData() {
            const dataStr = JSON.stringify(dadosSistema, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup-financeiro-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            alert('‚úÖ Backup exportado com sucesso!');
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            if (file.type !== 'application/json') {
                alert('‚ö†Ô∏è Por favor, selecione um arquivo JSON v√°lido');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('‚ö†Ô∏è Importar dados ir√° sobrescrever todos os dados atuais. Tem certeza?')) {
                        dadosSistema = importedData;
                        salvarDados();
                        sistemaConfigurado = dadosSistema.configuracao !== null;
                        inicializarSistema();
                        alert('‚úÖ Dados importados com sucesso!');
                    }
                } catch (error) {
                    alert('‚ùå Erro ao importar arquivo. Verifique se √© um backup v√°lido.');
                }
            };
            reader.readAsText(file);
        }

        // Fun√ß√µes Auxiliares (mantidas do sistema original)
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function salvarDados() {
            dadosSistema.ultimaAtualizacao = new Date().toISOString();
            localStorage.setItem('sistemaFinanceiro', JSON.stringify(dadosSistema));
        }

        function carregarDados() {
            const dados = localStorage.getItem('sistemaFinanceiro');
            if (dados) {
                try {
                    dadosSistema = JSON.parse(dados);
                    sistemaConfigurado = dadosSistema.configuracao !== null;
                    
                    // Migra√ß√£o para vers√£o com cart√µes (se necess√°rio)
                    if (!dadosSistema.cartoes) {
                        dadosSistema.cartoes = [];
                    }
                    if (!dadosSistema.comprasCartao) {
                        dadosSistema.comprasCartao = {};
                    }
                    if (dadosSistema.versao !== '1.1') {
                        dadosSistema.versao = '1.1';
                        salvarDados();
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                }
            }
        }

        // Auto-save a cada 30 segundos
        setInterval(() => {
            if (sistemaConfigurado) {
                salvarDados();
            }
        }, 30000);

        // Salvar antes de fechar a p√°gina
        window.addEventListener('beforeunload', salvarDados);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro Pessoal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 140px;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff8c00 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
            color: white;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid;
        }

        .summary-card.receitas {
            border-left-color: #28a745;
        }

        .summary-card.despesas {
            border-left-color: #dc3545;
        }

        .summary-card.saldo {
            border-left-color: #667eea;
        }

        .summary-card.cartoes {
            border-left-color: #17a2b8;
        }

        .summary-card h3 {
            font-size: 1.1rem;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-card.receitas .value {
            color: #28a745;
        }

        .summary-card.despesas .value {
            color: #dc3545;
        }

        .summary-card.saldo .value {
            color: #667eea;
        }

        .summary-card.cartoes .value {
            color: #17a2b8;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .valor-receita {
            color: #28a745;
            font-weight: 600;
        }

        .valor-despesa {
            color: #dc3545;
            font-weight: 600;
        }

        .valor-cartao {
            color: #17a2b8;
            font-weight: 600;
        }

        .month-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border-left: 4px solid #667eea;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .backup-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        /* Estilos espec√≠ficos para cart√µes */
        .cartao-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .cartao-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .cartao-nome {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .cartao-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            font-size: 0.9rem;
        }

        .cartao-info div {
            text-align: center;
        }

        .cartao-info .label {
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .cartao-info .value {
            font-weight: bold;
            font-size: 1rem;
        }

        .compra-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #17a2b8;
        }

        .compra-info {
            flex: 1;
        }

        .compra-data {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .compra-descricao {
            font-weight: 600;
            color: #2c3e50;
        }

        .compra-valor {
            font-size: 1.1rem;
            font-weight: bold;
            color: #17a2b8;
        }

        @media (max-width: 768px) {
            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .month-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .nav-tabs {
                flex-direction: column;
            }

            .cartao-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .compra-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .compra-valor {
                margin-top: 10px;
                align-self: flex-end;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .tipo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Sistema Financeiro Pessoal</h1>
            <p>Gerencie suas finan√ßas com intelig√™ncia e simplicidade</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('configuracao')">‚öôÔ∏è Configura√ß√£o</button>
            <button class="nav-tab" onclick="showTab('receitas')">üí∞ Receitas</button>
            <button class="nav-tab" onclick="showTab('despesas')">üí∏ Despesas</button>
            <button class="nav-tab" onclick="showTab('cartoes')">üí≥ Cart√µes</button>
            <button class="nav-tab" onclick="showTab('relatorios')">üìà Relat√≥rios</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="month-selector">
                <div class="form-group" style="margin-bottom: 0;">
                    <label>M√™s/Ano:</label>
                    <select id="currentMonth" class="form-control" onchange="updateDashboard()" style="width: auto; display: inline-block; margin-right: 15px;">
                    </select>
                </div>
                <button class="btn btn-primary" onclick="goToPreviousMonth()">‚óÄ M√™s Anterior</button>
                <button class="btn btn-primary" onclick="goToNextMonth()">Pr√≥ximo M√™s ‚ñ∂</button>
                <button class="btn btn-success" onclick="goToCurrentMonth()">üìÖ M√™s Atual</button>
            </div>

            <div class="summary-cards">
                <div class="summary-card receitas">
                    <h3>Total de Receitas</h3>
                    <div class="value" id="totalReceitas">R$ 0,00</div>
                    <small id="receitasCount">0 lan√ßamentos</small>
                </div>
                <div class="summary-card despesas">
                    <h3>Total de Despesas</h3>
                    <div class="value" id="totalDespesas">R$ 0,00</div>
                    <small id="despesasCount">0 lan√ßamentos</small>
                </div>
                <div class="summary-card saldo">
                    <h3>Saldo do M√™s</h3>
                    <div class="value" id="saldoMes">R$ 0,00</div>
                </div>
                <div class="summary-card saldo">
                    <h3>Saldo Acumulado</h3>
                    <div class="value" id="saldoAcumulado">R$ 0,00</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">üí∞ Receitas do M√™s</div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Valor</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="receitasList"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">üí∏ Despesas do M√™s</div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Valor</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="despesasList"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configura√ß√£o Tab -->
        <div id="configuracao" class="tab-content">
            <div class="card">
                <div class="card-header">‚öôÔ∏è Configura√ß√£o Inicial</div>
                <div class="card-body">
                    <div id="configStatus"></div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>M√™s de In√≠cio:</label>
                            <select id="mesInicio" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label>Ano de In√≠cio:</label>
                            <select id="anoInicio" class="form-control"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Saldo Inicial:</label>
                        <input type="number" id="saldoInicial" class="form-control" placeholder="R$ 0,00" step="0.01">
                    </div>
                    <button class="btn btn-success" onclick="configurarSistema()">üíæ Salvar Configura√ß√£o</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">üìÑ Backup e Dados</div>
                <div class="card-body">
                    <div class="backup-section">
                        <h4>üíæ Backup dos Dados</h4>
                        <p>Fa√ßa backup regular dos seus dados para n√£o perder informa√ß√µes importantes.</p>
                        <button class="btn btn-warning" onclick="exportData()">üì§ Exportar Dados</button>
                        <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üì• Importar Dados</button>
                        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(this)">
                    </div>
                </div>
            </div>
        </div>

        <!-- Receitas Tab -->
        <div id="receitas" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">‚ûï Adicionar Receita</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Tipo de Receita:</label>
                            <select id="tipoReceita" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label>Valor:</label>
                            <input type="number" id="valorReceita" class="form-control" placeholder="R$ 0,00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>M√™s/Ano:</label>
                            <select id="mesReceita" class="form-control"></select>
                        </div>
                        <button class="btn btn-success" onclick="adicionarReceita()">üí∞ Adicionar Receita</button>
                        <button class="btn btn-warning" onclick="showModal('modalLancamentoMassa', 'receita')">üìä Lan√ßamento em Massa</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">üè∑Ô∏è Gerenciar Tipos de Receita</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Novo Tipo:</label>
                            <input type="text" id="novoTipoReceita" class="form-control" placeholder="Ex: Sal√°rio, Freelance...">
                        </div>
                        <button class="btn btn-primary" onclick="criarTipoReceita()">‚ûï Criar Tipo</button>
                        <div id="tiposReceitaList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Despesas Tab -->
        <div id="despesas" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">‚ûï Adicionar Despesa</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Tipo de Despesa:</label>
                            <select id="tipoDespesa" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label>Valor:</label>
                            <input type="number" id="valorDespesa" class="form-control" placeholder="R$ 0,00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>M√™s/Ano:</label>
                            <select id="mesDespesa" class="form-control"></select>
                        </div>
                        <button class="btn btn-success" onclick="adicionarDespesa()">üí∏ Adicionar Despesa</button>
                        <button class="btn btn-warning" onclick="showModal('modalLancamentoMassa', 'despesa')">üìä Lan√ßamento em Massa</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">üè∑Ô∏è Gerenciar Tipos de Despesa</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Novo Tipo:</label>
                            <input type="text" id="novoTipoDespesa" class="form-control" placeholder="Ex: Aluguel, Mercado...">
                        </div>
                        <button class="btn btn-primary" onclick="criarTipoDespesa()">‚ûï Criar Tipo</button>
                        <div id="tiposDespesaList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart√µes Tab -->
        <div id="cartoes" class="tab-content">
            <div class="alert alert-info">
                <strong>üí≥ Gest√£o de Cart√µes de Cr√©dito</strong><br>
                Cadastre seus cart√µes, registre compras e acompanhe as faturas mensais automaticamente.
            </div>

            <div class="grid-2">
                <!-- Cadastro de Cart√£o -->
                <div class="card">
                    <div class="card-header">‚ûï Novo Cart√£o de Cr√©dito</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Nome do Cart√£o:</label>
                            <input type="text" id="nomeCartao" class="form-control" placeholder="Ex: Nubank, Ita√∫, Visa...">
                        </div>
                        <div class="form-group">
                            <label>Vencimento da Fatura:</label>
                            <input type="number" id="vencimentoCartao" class="form-control" 
                                   placeholder="Digite o dia (1-31)" min="1" max="31" 
                                   title="Digite o dia do vencimento da fatura (1 a 31)">
                            <small style="color: #6c757d; font-size: 0.8rem;">
                                üí° Exemplo: 25 (para todo dia 25 do m√™s)
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Melhor Dia para Compra:</label>
                            <input type="number" id="melhorDiaCartao" class="form-control" 
                                   placeholder="Digite o dia (1-31)" min="1" max="31"
                                   title="Digite o melhor dia para fazer compras (1 a 31)">
                            <small style="color: #6c757d; font-size: 0.8rem;">
                                üí° Compras ap√≥s este dia v√£o para a pr√≥xima fatura
                            </small>
                        </div>
                        <button class="btn btn-success" onclick="cadastrarCartao()">üí≥ Cadastrar Cart√£o</button>
                    </div>
                </div>

                <!-- Registro de Compra -->
                <div class="card">
                    <div class="card-header">üõí Registrar Compra</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Cart√£o:</label>
                            <select id="cartaoCompra" class="form-control">
                                <option value="">Selecione um cart√£o...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o da Compra:</label>
                            <input type="text" id="descricaoCompra" class="form-control" placeholder="Ex: Supermercado, Combust√≠vel...">
                        </div>
                        <div class="form-group">
                            <label>Valor:</label>
                            <input type="number" id="valorCompra" class="form-control" placeholder="R$ 0,00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Data da Compra:</label>
                            <input type="date" id="dataCompra" class="form-control">
                        </div>
                        <button class="btn btn-success" onclick="registrarCompra()">üõí Registrar Compra</button>
                    </div>
                </div>
            </div>

            <!-- Lista de Cart√µes Cadastrados -->
            <div class="card">
                <div class="card-header">üí≥ Meus Cart√µes</div>
                <div class="card-body">
                    <div id="listaCartoes">
                        <div class="alert alert-warning">
                            <strong>üìã Nenhum cart√£o cadastrado ainda</strong><br>
                            Use o formul√°rio acima para cadastrar seu primeiro cart√£o de cr√©dito.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compras do M√™s -->
            <div class="card">
                <div class="card-header">üõí Compras do M√™s Atual</div>
                <div class="card-body">
                    <div class="month-selector" style="margin-bottom: 20px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Filtrar por Cart√£o:</label>
                            <select id="filtroCartaoCompras" class="form-control" style="width: auto; display: inline-block;">
                                <option value="">Todos os cart√µes</option>
                            </select>
                        </div>
                    </div>

                    <div id="listaCompras">
                        <div class="alert alert-info">
                            <strong>üìã Nenhuma compra registrada ainda</strong><br>
                            Use o formul√°rio acima para registrar suas compras no cart√£o de cr√©dito.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios Tab -->
        <div id="relatorios" class="tab-content">
            <div class="card">
                <div class="card-header">üìà Vis√£o Anual</div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Ano:</label>
                        <select id="anoRelatorio" class="form-control" onchange="gerarRelatorioAnual()" style="width: 200px; display: inline-block;">
                        </select>
                    </div>
                    <div id="relatorioAnual"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Lan√ßamento em Massa -->
    <div id="modalLancamentoMassa" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalLancamentoMassa')">&times;</button>
            <div class="modal-header">
                <h2 id="modalTitle">Lan√ßamento em
